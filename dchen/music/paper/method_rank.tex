\subsection{Music recommendation as bipartite ranking}

We can formulate the playlist augmentation problem as bipartite ranking problems, 
and we want to learn a scorer $f$ such that, for a given playlist, 
songs in this playlist will be scored higher than those not in the given playlist,
which is known as the Top-Push loss~\cite{li2014top}
\begin{equation*}
\LCal_\textsc{tp} = \llb f_(u(i), i, m) \ge \max_{n: y_n^i=0} f(u(i), i, n), \ \forall m, y_m^i = 1.
\end{equation*}

The empirical risk is
$$
\RCal_\textsc{rank} 
= \frac{1}{N} \sum_{i=1}^N \frac{1}{M_+^i} \sum_{m: y_m^i = 1} \ell \left( f(u(i), i, m) - \max_{n: y_n^i = 0} f(u(i), i, n) \right).
$$

The optimisation problem of this formulation is
\begin{equation}
\label{eq:unconsopt}
\begin{aligned}
&\min_{\V, \W, \mubm} \ \RCal_\textsc{rank} + R(\V, \W, \mubm).
\end{aligned}
\end{equation}

Directly optimise the above problem is challenging due to the \emph{max} operator,
we could transform it into a constraint optimisation problem, as described in the next section.


\subsection{Formulate a constrained optimisation problem}
If we introduce a slack variable $\xi_i \ge f(u(i), i, n)$
we can reformulate problem~\ref{eq:unconsopt} as a constrained optimisation problem:
\begin{equation}
\label{eq:cvxopt}
\begin{aligned}
\min_{\V, \W, \mubm, \xibm} \ & R(\V, \W, \mubm)
  + \frac{1}{N} \sum_{i=1}^N \frac{1}{M_+^i} \sum_{m: y_m^i = 1} \ell \left( f(u(i), i, m) - \xi_i \right) \\
s.t. \quad & 
\xi_i \ge f(u(i), i, n), \\
& i \in \{1,\dots,N\}, \, n \in \{1,\dots,M\} \ \mathrm{and} \ y_n^i = 0.
\end{aligned}
\end{equation}

This is a convex optimisation problem with inequality constraints, 
and the number of constraints is 
$$
\sum_{i=1}^N \sum_{n=1}^M \llb y_n^i = 0 \rrb = MN - \sum_{i=1}^N \sum_{m=1}^M \llb y_m^i = 1 \rrb.
$$

Suppose we use the hinge loss $\ell(f, y) = \max \{ 0, \, 1 - fy \}$ as the convex surrogate of 0-1 loss, we have
\begin{equation*}
\ell \left( f(u(i), i, m) - \xi_i \right) = \max \left\{ 0, \, 1 - f( u(i), i, m) + \xi_i \right\}.
\end{equation*}

Inspired by the one-slack formulation of structured Support Vector Machine~\cite{joachims2009cutting}, 
we introduce another variable $\delta_i$ such that
\begin{equation*}
\begin{aligned}
\delta_{i,m} & \ge 0, \\
\delta_{i,m} & \ge 1 - f( u(i), i, m) + \xi_i, 
\end{aligned}
\end{equation*}
as a result,
\begin{equation*}
\ell \left( f(u(i), i, m) - \xi_i \right) = \delta_{i,m},
\end{equation*}
we further let
\begin{equation*}
\delta_i = \sum_{m: y_m^i = 1} \delta_{i,m} = \sum_{m: y_m^i = 1} \ell \left( f(u(i), i, m) - \xi_i \right),
\end{equation*}
then we can reformulate convex optimisation problem~\ref{eq:cvxopt} into a quadratic program,
\begin{equation}
\label{eq:qp}
\begin{aligned}
\min_{\V, \W, \mubm, \xibm, \deltabm} \ & R(\V, \W, \mubm) + \frac{1}{N} \sum_{i=1}^N \frac{\delta_i}{M_+^i} \\
s.t. \quad 
& \xi_i \ge f(u(i), i, n), \\
& \delta_i \ge \sum_{m: y_m^i = 1} \left( 1 - f( u(i), i, m) + \xi_i \right), \ \delta_i \ge 0 \\
& i \in \{1,\dots,N\}, \\
& m, n \in \{1,\dots,M\} \ \mathrm{and} \ \y_m^i = 1, \,  y_n^i = 0. 
\end{aligned}
\end{equation}

The number of variables in problem~\ref{eq:qp} is $(U + N + 1) D + 2N$ and the number of constraints is
$$
\sum_{i=1}^N \sum_{n=1}^M \llb y_n^i = 0 \rrb + N = MN - \sum_{i=1}^N \sum_{m=1}^M \llb y_m^i = 1 \rrb + N,
$$
%
note that the number of songs in each playlist is very small compared with the total number of songs $M$ in music collection,
it means the number of constraints is of order $O(MN)$ which can be very big for a system with a large number of both songs and playlists,
this is generally true for production systems deployed by music streaming service providers.

To address this issue, we propose to use a cutting plane method which starts by using a small number of constraints,
optimise the above objective using an off-the-shelf QP solver,
then search new constraints using the following greedy strategy,
\begin{equation*}
\widetilde n_i = \argmax_{n: y_i^n=0} f(u(i), i, n),
\end{equation*}
if example $x_n$ violated constraint
\begin{equation*}
f(u(i), i, \widetilde n_i) - \xi_i + \epsilon \le 0,
\end{equation*}
we add this constraint to the previous set of constraints to form a new QP with the same objective,
then solve this new problem, we keep doing this procedure until a solution that does not violate any constraints has been found.
